<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auth Demo</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="sidebar-holder"></div>
  <link rel="stylesheet" href="/sidebar.css">
  <script src="/sidebar.js" defer></script>
  <script src="/theme.js" defer></script>
  <!-- Librairies pour l‚Äôexport PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>
  <div id="login-container">
    <h2>Connexion</h2>
    <form id="login-form">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Mot de passe" required />
      <button type="submit">Se connecter</button>
    </form>
    <div id="login-error" style="color:red;"></div>
  </div>

  <div id="app-container" style="display:none;">
    <h1>Bienvenue</h1>
    <button id="logoutBtn">D√©connexion</button>
    <button id="themeToggle" type="button" title="Basculer clair/sombre">üåì</button>
    <nav>
      <a href="selection.html" id="nav-selection" class="btn btn-primary">
        Gestion des t√¢ches
      </a>
      <button id="historiqueBtn" class="btn btn-secondary">
        Historique des bulles
      </button>
    </nav>
    <label>Chantier :
      <select id="chantierSelect"></select>
    </label>

    <label>√âtage :
      <select id="etageSelect">
        <!-- valeur lisible R+X mais l'identifiant num√©rique est dans data-floor-id -->
        <option value="R+0" data-floor-id="0">R+0</option>
        <option value="R+1" data-floor-id="1">R+1</option>
        <option value="R+2" data-floor-id="2">R+2</option>
        <option value="R+3" data-floor-id="3">R+3</option>
        <option value="R+4" data-floor-id="4">R+4</option>
        <option value="R+5" data-floor-id="5">R+5</option>
      </select>
    </label>

    <label>Chambre :
      <select id="chambreSelect" data-etage="R+5">
        <option value="total">-- Toutes les chambres --</option>
        <!-- etc. -->
      </select>
    </label>

    <label>Statut :
      <select id="statusFilter">
        <option value="">-- Tous les statuts --</option>
        <option value="attente">En attente</option>
        <option value="a_corriger">√Ä corriger</option>
        <option value="corrige">Corrig√©</option>
        <option value="validee">Valid√©</option>
        <option value="abandonnee">Abandonn√©</option>
      </select>
    </label>

    <!-- Format d‚Äôexport -->
    <label for="export-format">Format :</label>
    <select id="export-format">
      <option value="csv">CSV</option>
      <option value="xlsx">Excel</option>
      <option value="pdf">PDF</option>
    </select>
    <fieldset id="export-columns">
      <legend>Colonnes √† inclure :</legend>
      <label><input type="checkbox" name="col" value="id" checked> ID</label>
      <label><input type="checkbox" name="col" value="created_by_email" checked> Utilisateur</label>
      <label><input type="checkbox" name="col" value="modified_by_email"> Modifi√© par (email)</label>
      <label><input type="checkbox" name="col" value="etage" checked> √âtage</label>
      <label><input type="checkbox" name="col" value="chambre" checked> Chambre</label>
      <label><input type="checkbox" name="col" value="numero" checked> N¬∞</label>
      <label><input type="checkbox" name="col" value="lot" checked> Lot</label>
      <label><input type="checkbox" name="col" value="intitule" checked> Intitul√©</label>
      <label><input type="checkbox" name="col" value="description"> Description</label>
      <label><input type="checkbox" name="col" value="etat" checked> √âtat</label>
      <label><input type="checkbox" name="col" value="entreprise" checked> Entreprise</label>
      <label><input type="checkbox" name="col" value="localisation"> Localisation</label>
      <label><input type="checkbox" name="col" value="observation" checked> Observation</label>
      <label><input type="checkbox" name="col" value="date_butoir"> Date butoir</label>
      <label><input type="checkbox" name="col" value="photos" checked> Photos (tous les liens)</label>
      <label><input type="checkbox" name="col" value="videos" checked> Vid√©os (tous les liens)</label>
      <label><input type="checkbox" name="col" value="levee_fait_par_email" checked> Lev√©e ‚Äì Fait par</label>
      <label><input type="checkbox" name="col" value="levee_fait_le" checked> Lev√©e ‚Äì Fait le</label>
      <label><input type="checkbox" name="col" value="levee_commentaire" checked> Lev√©e ‚Äì Commentaire</label>
      <label><input type="checkbox" name="col" value="levee_photos" checked> Lev√©e ‚Äì Photos</label>
    </fieldset>
    <!-- Nouveau bouton Export -->
    <button id="exportBtn">Exporter</button>

    <div id="plan-container">
      <img id="plan" src="plan-r5.png" alt="Plan √©tage" />
      <div id="bulles-container"></div>
    </div>
  </div>

  <script src="script.js"></script>
  <script src="selection.js"></script>
  <script>
    (function() {
      const KEY = 'theme';
      const root = document.documentElement; // <html>
      const btn = document.getElementById('themeToggle');

      function apply(theme) {
        root.setAttribute('data-theme', theme);
        localStorage.setItem(KEY, theme);
        if (btn) btn.setAttribute('aria-label', theme === 'dark' ? 'Passer en clair' : 'Passer en sombre');
      }

      const saved = localStorage.getItem(KEY);
      const initial = saved || root.getAttribute('data-theme') || 'light';
      apply(initial);

      if (btn) {
        btn.addEventListener('click', () => {
          const current = root.getAttribute('data-theme') || 'light';
          apply(current === 'dark' ? 'light' : 'dark');
        });
      }
    })();
  </script>
</body>
</html>
