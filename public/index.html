<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auth Demo</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="/img/brh-logo.png" type="image/png">
</head>
<body class="login-page">
  <div id="sidebar-holder"></div>
  <link rel="stylesheet" href="/sidebar.css">
  <script src="/sidebar.js" defer></script>
  <script src="/theme.js" defer></script>
  <!-- Librairies pour l‚Äôexport PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>
  <!-- ‚ö†Ô∏è login-container = fond plein √©cran ; auth-wrapper = largeur contrainte -->
  <div id="login-container">
    <div class="auth-wrapper">
      <div class="auth-card">
      <div class="auth-brand">
        <img src="/img/brh-logo.png" alt="B√¢ti R√©nov H√¥tellerie" class="auth-logo" />
        <div class="auth-heading">
          <h1>Portail BRH</h1>
          <p>Connectez-vous pour acc√©der √† votre espace de suivi des chantiers.</p>
        </div>
      </div>
      <form id="login-form" class="auth-form">
        <div class="form-group">
          <label for="email">Adresse e-mail</label>
          <div class="input-wrapper">
            <span class="input-icon" aria-hidden="true">‚úâÔ∏è</span>
            <input type="email" id="email" placeholder="prenom.nom@entreprise.com" required />
          </div>
        </div>
        <div class="form-group">
          <label for="password">Mot de passe</label>
          <div class="input-wrapper">
            <span class="input-icon" aria-hidden="true">üîí</span>
            <input type="password" id="password" placeholder="Votre mot de passe" required />
          </div>
        </div>
        <button type="submit" class="btn-primary">Se connecter</button>
      </form>
      <div id="login-error" class="auth-error" role="alert"></div>
      <div class="auth-footer">
        <small>Assistance : <a href="mailto:support@bati-renov-hotellerie.fr">support@bati-renov-hotellerie.fr</a></small>
      </div>
      </div><!-- /.auth-card -->
    </div><!-- /.auth-wrapper -->
  </div>

  <div id="app-container" style="display:none;">
    <header class="brand-bar">
      <img src="/img/brh-logo.png" class="brand-logo" alt="B√¢ti R√©nov H√¥tellerie">
      <div class="brand-actions">
        <button id="logoutBtn">D√©connexion</button>
        <button id="themeToggleIndex" data-theme-toggle type="button" title="Basculer clair/sombre">üåì</button>
      </div>
    </header>
    <h1>Bienvenue</h1>
    <nav>
      <a href="selection.html" id="nav-selection" class="btn btn-secondary">
        Gestion des t√¢ches
      </a>
      <button id="historiqueBtn" class="btn btn-secondary">
        Historique des bulles
      </button>
    </nav>
    <div class="filter-group">
      <label for="chantierSelect">Chantier</label>
      <div class="filter-control">
        <select id="chantierSelect"></select>
        <div class="filter-actions">
          <button id="addChantierBtn" class="btn btn-secondary is-hidden" aria-controls="chantierSelect">+ Nouveau chantier</button>
        </div>
      </div>
    </div>

    <div class="filter-group">
      <label for="etageSelect">√âtage</label>
      <div class="filter-control">
        <select id="etageSelect">
          <!-- valeur lisible R+X mais l'identifiant num√©rique est dans data-floor-id -->
          <option value="R+0" data-floor-id="0">R+0</option>
          <option value="R+1" data-floor-id="1">R+1</option>
          <option value="R+2" data-floor-id="2">R+2</option>
          <option value="R+3" data-floor-id="3">R+3</option>
          <option value="R+4" data-floor-id="4">R+4</option>
          <option value="R+5" data-floor-id="5">R+5</option>
        </select>
        <div class="filter-actions">
          <button id="addEtageBtn" class="btn btn-secondary is-hidden" aria-controls="etageSelect">+ Nouvel √©tage</button>
          <button id="uploadPlanBtn" class="btn btn-secondary is-hidden" aria-controls="uploadPlanInput">üìé Upload plan</button>
        </div>
      </div>
    </div>

    <div class="filter-group">
      <label for="chambreSelect">Chambre</label>
      <div class="filter-control">
        <select id="chambreSelect" data-etage="R+5">
          <option value="total">-- Toutes les chambres --</option>
          <!-- etc. -->
        </select>
        <div class="filter-actions">
          <button id="addRoomBtn" class="btn btn-secondary is-hidden" aria-controls="chambreSelect">+ Nouvelle chambre</button>
        </div>
      </div>
    </div>

    <div class="filter-group">
      <label for="statusFilter">Statut</label>
      <div class="filter-control">
        <select id="statusFilter">
          <option value="">-- Tous les statuts --</option>
          <option value="a_corriger">√Ä corriger</option>
          <option value="levee">Lev√©e</option>
        </select>
      </div>
    </div>

    <!-- Format d‚Äôexport -->
    <label for="export-format">Format :</label>
    <select id="export-format">
      <option value="csv">CSV</option>
      <option value="xlsx">Excel</option>
      <option value="pdf">PDF</option>
    </select>
    <label>Phase :
      <select id="phaseSelect">
        <option value="">(Aucune)</option>
        <option value="1">Phase 1</option>
        <option value="2">Phase 2</option>
        <option value="all">Toutes</option>
      </select>
    </label>
    <fieldset id="export-columns">
      <legend>Colonnes √† inclure :</legend>
      <label><input type="checkbox" name="col" value="id"> ID</label>
      <label><input type="checkbox" name="col" value="created_by_email" checked> Utilisateur</label>
      <label><input type="checkbox" name="col" value="modified_by_email"> Modifi√© par (email)</label>
      <label><input type="checkbox" name="col" value="etage" checked> √âtage</label>
      <label><input type="checkbox" name="col" value="chambre" checked> Chambre</label>
      <label><input type="checkbox" name="col" value="numero" checked> N¬∞</label>
      <label><input type="checkbox" name="col" value="lot" checked> Lot</label>
      <label><input type="checkbox" name="col" value="intitule" checked> Intitul√©</label>
      <label><input type="checkbox" name="col" value="description"> Description</label>
      <label><input type="checkbox" name="col" value="etat" checked> √âtat</label>
      <label><input type="checkbox" name="col" value="localisation"> Localisation</label>
      <label><input type="checkbox" name="col" value="observation" checked> Observation</label>
      <label><input type="checkbox" name="col" value="date_butoir"> Date butoir</label>
      <label><input type="checkbox" name="col" value="creation_photos" checked> Photos (cr√©ation)</label>
      <label><input type="checkbox" name="col" value="levee_photos" checked> Photos (lev√©e)</label>
      <label><input type="checkbox" name="col" value="photos"> Photos (tous les liens)</label>
      <label><input type="checkbox" name="col" value="videos" checked> Vid√©os (tous les liens)</label>
      <label><input type="checkbox" name="col" value="levee_fait_par_email" checked> Fait par</label>
      <label><input type="checkbox" name="col" value="levee_fait_le" checked> Fait le</label>
      <label><input type="checkbox" name="col" value="levee_commentaire"> Lev√©e ‚Äì Commentaire</label>
    </fieldset>
    <button id="exportPhaseBtn">Exporter (par phase)</button>
    <!-- Bouton d'export existant conserv√© (d√©clenche le flux d'export r√©el) -->
    <button id="exportRunBtn" class="btn btn-primary" type="button" style="display: none;">Exporter</button>
    <!-- Nouveau bouton visible : ouvre la modale -->
    <button id="exportBtn" class="btn btn-primary" type="button">Exporter</button>

    <div id="plan-container">
      <img id="plan" src="plan-r5.png" alt="Plan √©tage" />
      <div id="bulles-container"></div>
    </div>
  </div>

  <!-- ========= Modale d‚Äôexport ========= -->
  <div id="exportModal" class="modal" aria-hidden="true">
    <div class="modal__backdrop" data-export-close></div>
    <div class="modal__panel export-modal" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
      <div class="modal__header">
        <h3 id="exportModalTitle">Exporter</h3>
        <button class="modal__close" aria-label="Fermer" type="button" data-export-close>‚úï</button>
      </div>
      <div class="modal__body">
        <div class="export-modal__section">
          <h4>Format</h4>
          <div class="export-modal__formats">
            <label><input type="radio" name="exportFormat" value="csv"> CSV</label>
            <label><input type="radio" name="exportFormat" value="xlsx"> Excel</label>
            <label><input type="radio" name="exportFormat" value="pdf"> PDF</label>
          </div>
        </div>
        <div class="export-modal__section">
          <h4>Colonnes √† inclure</h4>
          <!-- Les cases du fieldset #export-columns sont dupliqu√©es ici par le script -->
          <div id="exportModalCols" class="export-modal__cols"></div>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn btn-secondary" type="button" data-export-close>Annuler</button>
        <button id="export-confirm" class="btn btn-primary" type="button">Confirmer</button>
      </div>
    </div>
  </div>
  <!-- ======== /Modale d‚Äôexport ======== -->

  <script src="script.js"></script>
  <script src="selection.js"></script>
</body>
</html>
